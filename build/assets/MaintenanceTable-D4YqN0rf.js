import{c as Ye,j as e,a as Qe,u as ke,r as p,D as _e,b as Je,d as We,e as Xe,f as Ze,L as xe,P as es,g as ss,B as h,C as k,h as as,i as ts,S as ns,k as rs,l as ls,m as is,n as cs,o as os,t as ae,p as ds,q as Se,G as me,s as De,v as Me,w as xs,x as ms,y as hs,z as gs,A as js,E as us,K as ps,F as ys,H as Ns,I as vs,T as q}from"./index-itMr2fPr.js";import{B as C}from"./badge-ROg77qfE.js";import{A as R,a as Y,b as Q,c as _,d as J,e as W,f as X,g as Z,h as ee}from"./alert-dialog-FLTPuMfd.js";import{P as fs,S as se}from"./square-pen-NxlkeYwy.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],he=Ye("user",bs);function ws({className:A,...S}){return e.jsx("textarea",{"data-slot":"textarea",className:Qe("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",A),...S})}function Cs({open:A,onOpenChange:S,task:o,field:D,onSave:te}){const z=ke(),[w,v]=p.useState(null),[F,E]=p.useState(""),[T,B]=p.useState("");p.useEffect(()=>{o&&(v(o.lastMaintenance),E(o.assignedTo),B(o.opmerkingen))},[o]);const K=()=>{if(!o)return;const c={...o,lastMaintenance:w,assignedTo:F,opmerkingen:T,commentDate:D==="opmerkingen"&&T!==o.opmerkingen?new Date:o.commentDate};if(D==="lastMaintenance"&&w){const j=new Date(w);switch(o.maintenanceIntervalUnit){case"days":j.setDate(j.getDate()+o.maintenanceInterval);break;case"weeks":j.setDate(j.getDate()+o.maintenanceInterval*7);break;case"months":j.setMonth(j.getMonth()+o.maintenanceInterval);break}c.nextMaintenance=j}te(c),ae.success("Task updated successfully"),S(!1)},ne=c=>{if(!c)return"Pick a date";const j=new Date(c),re=j.getFullYear(),I=String(j.getMonth()+1).padStart(2,"0"),G=String(j.getDate()).padStart(2,"0");return`${re}/${I}/${G}`},V=()=>o?z.operators.filter(c=>c.active&&c.presses.includes(o.press)):[];return o?e.jsx(_e,{open:A,onOpenChange:S,children:e.jsxs(Je,{className:"max-w-md",children:[e.jsxs(We,{children:[e.jsx(Xe,{children:D==="lastMaintenance"?"Update Last Maintenance":"Update Opmerkingen"}),e.jsx(Ze,{children:D==="lastMaintenance"?"Update the last maintenance date and who performed it.":"Update the maintenance notes."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[D==="lastMaintenance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(xe,{children:"Last Maintenance Date"}),e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsxs(h,{variant:"outline",className:"justify-start text-left",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),ne(w)]})}),e.jsx(as,{className:"w-auto p-0",align:"start",children:e.jsx(ts,{mode:"single",selected:w||void 0,onSelect:c=>v(c||null),initialFocus:!0})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(xe,{children:"Assigned To"}),e.jsxs(ns,{value:F,onValueChange:E,children:[e.jsx(rs,{children:e.jsx(ls,{placeholder:"Select an operator"})}),e.jsx(is,{children:V().map(c=>e.jsx(cs,{value:c.name,children:c.name},c.id))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(xe,{children:"Opmerkingen"}),e.jsx(ws,{value:T,onChange:c=>B(c.target.value),rows:4,placeholder:"Add maintenance notes..."})]})]}),e.jsxs(os,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(h,{type:"button",onClick:K,children:"Save Changes"})]})]})}):null}function Ts({tasks:A,onEdit:S,onDelete:o,onUpdate:D,onEditGroup:te,onAddTask:z,onUpdateTaskOrder:w}){const{user:v,categoryOrder:F,updateCategoryOrder:E}=ke(),[T,B]=p.useState(new Set),[K,ne]=p.useState(new Set),[V,c]=p.useState(null),[j,re]=p.useState("lastMaintenance"),[I,G]=p.useState(null),[g,Ae]=p.useState(null),[f,le]=p.useState(null),Te=ds(Se(ys),Se(ps,{coordinateGetter:us})),ge=(s,t)=>({id:s.id,task:s.subtaskName,taskSubtext:s.subtext,category:t.category,press:t.press,lastMaintenance:s.lastMaintenance,nextMaintenance:s.nextMaintenance,maintenanceInterval:s.maintenanceInterval,maintenanceIntervalUnit:s.maintenanceIntervalUnit,assignedTo:s.assignedTo,opmerkingen:s.comment,commentDate:s.commentDate,created:new Date().toISOString(),updated:new Date().toISOString()}),Ie=s=>{if(!s)return"N/A";const t=new Date(s),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${r}/${n}/${l}`},Oe=s=>{if(!s)return"N/A";const t=new Date(s),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),d=String(t.getHours()).padStart(2,"0"),x=String(t.getMinutes()).padStart(2,"0");return`${r}/${n}/${l} ${d}:${x}`},Ue=(s,t)=>`${s} ${t}`,O=s=>{const t=new Date,r=new Date(s),n=Math.ceil((r.getTime()-t.getTime())/(1e3*60*60*24));return n<0?{label:"Overdue",color:"bg-red-50",textColor:"text-red-700",badgeClass:"bg-red-500 hover:bg-red-600"}:n<=7?{label:"Due Soon",color:"bg-orange-50",textColor:"text-orange-700",badgeClass:"bg-orange-500 hover:bg-orange-600"}:n<=30?{label:"Upcoming",color:"bg-yellow-50",textColor:"text-yellow-700",badgeClass:"bg-yellow-500 hover:bg-yellow-600"}:{label:"Scheduled",color:"",textColor:"",badgeClass:"bg-gray-200 hover:bg-gray-300 text-gray-700"}},$e=s=>{const t=new Set(T);t.has(s)?t.delete(s):t.add(s),B(t)},Fe=s=>{const t=new Set(K);t.has(s)?t.delete(s):t.add(s),ne(t)},Pe=(s,t,r)=>{c(ge(s,t)),re(r)},Le=(s,t)=>{o(s),ae.success(`${t} deleted successfully`)},ze=s=>{G(s)},Ee=(s,t)=>{if(s.preventDefault(),I&&I!==t){const r=[...F],n=r.indexOf(I),l=r.indexOf(t);r.splice(n,1),r.splice(l,0,I),E(r)}},Be=()=>{G(null)},Ke=async(s,t)=>{const{active:r,over:n}=s;if(n&&r.id!==n.id){const l=ie[t],d=l.findIndex(u=>u.id===r.id),x=l.findIndex(u=>u.id===n.id),b=js(l,d,x).map(u=>u.id);if(w)try{await w(t,b),ae.success("Task order updated")}catch{ae.error("Failed to update task order")}}},U=A.flatMap(s=>s.subtasks).reduce((s,t)=>{const r=O(t.nextMaintenance).label;return r!=="Scheduled"&&(s[r]=(s[r]||0)+1),s},{}),ie=A.reduce((s,t)=>(s[t.category]||(s[t.category]=[]),s[t.category].push(t),s),{}),je=F.filter(s=>ie[s]?.length>0),ce=s=>{Ae(g===s?null:s)},Ve=s=>{f?.key===s?f.direction==="asc"?le({key:s,direction:"desc"}):le(null):le({key:s,direction:"asc"})},ue=s=>f?[...s].sort((t,r)=>{let n,l;const d=t.subtasks[0],x=r.subtasks[0];switch(f.key){case"task":n=t.taskName.toLowerCase(),l=r.taskName.toLowerCase();break;case"lastMaintenance":n=d?.lastMaintenance?new Date(d.lastMaintenance).getTime():0,l=x?.lastMaintenance?new Date(x.lastMaintenance).getTime():0;break;case"nextMaintenance":n=d?.nextMaintenance?new Date(d.nextMaintenance).getTime():0,l=x?.nextMaintenance?new Date(x.nextMaintenance).getTime():0;break;case"status":n=O(d?.nextMaintenance).label,l=O(x?.nextMaintenance).label;break;case"assignedTo":n=d?.assignedTo?.toLowerCase()||"",l=x?.assignedTo?.toLowerCase()||"";break;default:return 0}return n<l?f.direction==="asc"?-1:1:n>l?f.direction==="asc"?1:-1:0}):s,P=({label:s,sortKey:t,className:r="px-3 py-2 text-left text-gray-700"})=>{const n=f?.key===t;return e.jsx("th",{className:r,children:e.jsxs("button",{onClick:()=>Ve(t),className:"flex items-center gap-1 hover:text-gray-900 transition-colors w-full",children:[e.jsx("span",{children:s}),n&&e.jsx("span",{className:"text-xs text-blue-600",children:f.direction==="asc"?"↑":"↓"})]})})};function Ge({groupedTask:s,isSingleTask:t,isGroupedTaskCollapsed:r,relevantSubtasks:n,user:l,toggleGroupedTask:d,onEditGroup:x,handleDelete:M,getStatusInfo:b,formatDate:u,formatDateTime:oe,formatInterval:de,handleQuickEdit:H,toMaintenanceTask:pe,onEdit:ye,sortConfig:L}){const{attributes:Ne,listeners:ve,setNodeRef:fe,transform:He,transition:qe,isDragging:Re}=Ns({id:s.id}),be={transform:vs.Transform.toString(He),transition:qe,opacity:Re?.8:1},we=p.useMemo(()=>L?[...n].sort((a,i)=>{let N,m;switch(L.key){case"task":N=a.subtaskName.toLowerCase(),m=i.subtaskName.toLowerCase();break;case"lastMaintenance":N=a.lastMaintenance?new Date(a.lastMaintenance).getTime():0,m=i.lastMaintenance?new Date(i.lastMaintenance).getTime():0;break;case"nextMaintenance":N=a.nextMaintenance?new Date(a.nextMaintenance).getTime():0,m=i.nextMaintenance?new Date(i.nextMaintenance).getTime():0;break;case"status":N=b(a.nextMaintenance).label,m=b(i.nextMaintenance).label;break;case"assignedTo":N=a.assignedTo?.toLowerCase()||"",m=i.assignedTo?.toLowerCase()||"";break;default:return 0}return N<m?L.direction==="asc"?-1:1:N>m?L.direction==="asc"?1:-1:0}):n,[n,L,b]),y=p.useMemo(()=>n.length===0?null:n.reduce((a,i)=>a.nextMaintenance?i.nextMaintenance?new Date(a.nextMaintenance)<new Date(i.nextMaintenance)?a:i:a:i),[n]),$=y?b(y.nextMaintenance):null,Ce=$&&$.label!=="Scheduled"?$.color:"";return e.jsxs(e.Fragment,{children:[!t&&e.jsxs("tr",{ref:fe,style:be,className:`bg-gray-50 border-b border-gray-100 ${r&&Ce?Ce:""}`,children:[e.jsx("td",{colSpan:r?1:l?.role==="admin"?8:l?.role==="press"?6:7,className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-start",children:[l?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center mt-1",children:e.jsx("button",{type:"button",className:"cursor-grab active:cursor-grabbing text-gray-400 hover:text-gray-600 touch-none",...Ne,...ve,children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center mt-1",children:e.jsx("button",{onClick:()=>d(s.id),className:"text-gray-500 hover:text-gray-700",children:r?e.jsx(De,{className:"w-4 h-4"}):e.jsx(Me,{className:"w-4 h-4"})})}),e.jsx("div",{className:"flex-1",children:e.jsxs("button",{className:"text-left w-full",onClick:()=>d(s.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.taskName}),e.jsxs(C,{variant:"secondary",className:"ml-2",children:[n.length," subtasks"]})]}),s.taskSubtext&&e.jsx("div",{className:"text-gray-500 text-xs mt-0.5",children:s.taskSubtext})]})}),l?.role==="admin"&&!r&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),x?.(s)},children:e.jsx(se,{className:"w-4 h-4"})}),e.jsxs(R,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",onClick:a=>a.stopPropagation(),children:e.jsx(q,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(Q,{children:[e.jsxs(_,{children:[e.jsx(J,{children:"Delete Grouped Task"}),e.jsxs(W,{children:['Are you sure you want to delete "',s.taskName,'" and all its subtasks?']})]}),e.jsxs(X,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(ee,{onClick:()=>M(s.id,s.taskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})]})}),r&&y&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:u(y.lastMaintenance)})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(k,{className:"w-4 h-4"}),u(y.nextMaintenance)]})}),l?.role!=="press"&&e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:"text-gray-600",children:de(y.maintenanceInterval,y.maintenanceIntervalUnit)})}),e.jsx("td",{className:"px-3 py-1.5",children:$&&e.jsx(C,{className:$.badgeClass,children:$.label})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:y.assignedTo})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"line-clamp-2 text-gray-600",children:y.comment}),y.commentDate&&e.jsx("div",{className:"text-gray-400 text-xs",children:oe(y.commentDate)})]})}),l?.role==="admin"&&e.jsx("td",{className:"px-3 py-1.5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),x?.(s)},children:e.jsx(se,{className:"w-4 h-4"})}),e.jsxs(R,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",onClick:a=>a.stopPropagation(),children:e.jsx(q,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(Q,{children:[e.jsxs(_,{children:[e.jsx(J,{children:"Delete Grouped Task"}),e.jsxs(W,{children:['Are you sure you want to delete "',s.taskName,'" and all its subtasks?']})]}),e.jsxs(X,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(ee,{onClick:()=>M(s.id,s.taskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]})]}),t&&we.map(a=>{const i=b(a.nextMaintenance),N=i.label!=="Scheduled"?i.color:"";return e.jsxs("tr",{ref:fe,style:be,className:`border-b border-gray-100 last:border-0 hover:bg-gray-50/50 ${N}`,children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-start",children:[l?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center mt-1",children:e.jsx("button",{type:"button",className:"cursor-grab active:cursor-grabbing text-gray-400 hover:text-gray-600 touch-none",...Ne,...ve,children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsx("div",{className:"w-6 flex-shrink-0"}),e.jsxs("div",{className:"max-w-xs flex-1",children:[e.jsx("div",{className:"line-clamp-2",children:a.subtaskName}),a.subtext&&e.jsx("div",{className:"text-gray-500 text-xs line-clamp-1",children:a.subtext})]})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>H(a,s,"lastMaintenance"),children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:u(a.lastMaintenance)})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(k,{className:"w-4 h-4"}),u(a.nextMaintenance)]})}),l?.role!=="press"&&e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:"text-gray-600",children:de(a.maintenanceInterval,a.maintenanceIntervalUnit)})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx(C,{className:i.badgeClass,children:i.label})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.assignedTo})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>H(a,s,"opmerkingen"),children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"line-clamp-2 text-gray-600",children:a.comment||"Click to add..."}),a.commentDate&&e.jsx("div",{className:"text-gray-400 text-xs",children:oe(a.commentDate)})]})}),l?.role==="admin"&&e.jsx("td",{className:"px-3 py-1.5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),ye(pe(a,s))},children:e.jsx(se,{className:"w-4 h-4"})}),e.jsxs(R,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",onClick:m=>m.stopPropagation(),children:e.jsx(q,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(Q,{children:[e.jsxs(_,{children:[e.jsx(J,{children:"Delete Subtask"}),e.jsxs(W,{children:['Are you sure you want to delete "',a.subtaskName,'"? This action cannot be undone.']})]}),e.jsxs(X,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(ee,{onClick:()=>M(a.id,a.subtaskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]},a.id)}),!t&&!r&&we.map(a=>{const i=b(a.nextMaintenance),N=i.label!=="Scheduled"?i.color:"";return e.jsxs("tr",{className:`border-b border-gray-100 last:border-0 hover:bg-gray-50/50 ${N}`,children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-start",children:[l?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0"}),e.jsx("div",{className:"w-6 flex-shrink-0"}),e.jsxs("div",{className:"max-w-xs flex-1",children:[e.jsx("div",{className:"line-clamp-2",children:a.subtaskName}),a.subtext&&e.jsx("div",{className:"text-gray-500 text-xs line-clamp-1",children:a.subtext})]})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>H(a,s,"lastMaintenance"),children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:u(a.lastMaintenance)})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(k,{className:"w-4 h-4"}),u(a.nextMaintenance)]})}),l?.role!=="press"&&e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:"text-gray-600",children:de(a.maintenanceInterval,a.maintenanceIntervalUnit)})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx(C,{className:i.badgeClass,children:i.label})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.assignedTo})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>H(a,s,"opmerkingen"),children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"line-clamp-2 text-gray-600",children:a.comment||"Click to add..."}),a.commentDate&&e.jsx("div",{className:"text-gray-400 text-xs",children:oe(a.commentDate)})]})}),l?.role==="admin"&&e.jsx("td",{className:"px-3 py-1.5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:m=>{m.stopPropagation(),ye(pe(a,s))},children:e.jsx(se,{className:"w-4 h-4"})}),e.jsxs(R,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",onClick:m=>m.stopPropagation(),children:e.jsx(q,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(Q,{children:[e.jsxs(_,{children:[e.jsx(J,{children:"Delete Subtask"}),e.jsxs(W,{children:['Are you sure you want to delete "',a.subtaskName,'"? This action cannot be undone.']})]}),e.jsxs(X,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(ee,{onClick:()=>M(a.id,a.subtaskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]},a.id)})]})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Maintenance Tasks"}),e.jsxs("div",{className:"flex items-center gap-2",children:[U.Overdue>0&&e.jsxs(h,{variant:g==="Overdue"?"default":"outline",size:"sm",onClick:()=>ce("Overdue"),className:"gap-2",children:[e.jsx("span",{className:g==="Overdue"?"text-white":"text-red-600",children:"Overdue"}),e.jsx(C,{variant:g==="Overdue"?"secondary":"default",className:"bg-red-500",children:U.Overdue})]}),U["Due Soon"]>0&&e.jsxs(h,{variant:g==="Due Soon"?"default":"outline",size:"sm",onClick:()=>ce("Due Soon"),className:"gap-2",children:[e.jsx("span",{className:g==="Due Soon"?"text-white":"text-orange-600",children:"Due Soon"}),e.jsx(C,{variant:g==="Due Soon"?"secondary":"default",className:"bg-orange-500",children:U["Due Soon"]})]}),U.Upcoming>0&&e.jsxs(h,{variant:g==="Upcoming"?"default":"outline",size:"sm",onClick:()=>ce("Upcoming"),className:"gap-2",children:[e.jsx("span",{className:g==="Upcoming"?"text-white":"text-yellow-600",children:"Upcoming"}),e.jsx(C,{variant:g==="Upcoming"?"secondary":"default",className:"bg-yellow-500",children:U.Upcoming})]})]}),z&&e.jsxs(h,{onClick:z,size:"sm",className:"gap-2",children:[e.jsx(fs,{className:"w-4 h-4"}),"Add Task"]})]}),e.jsx("div",{className:"space-y-3",children:je.length===0?e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-12 text-center text-gray-500",children:"No maintenance tasks found. Add your first task to get started."}):je.map(s=>{const t=ie[s],r=T.has(s);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center px-3 py-2 bg-gray-50 border-b border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>$e(s),draggable:v?.role==="admin",onDragStart:()=>ze(s),onDragOver:n=>Ee(n,s),onDragEnd:Be,children:[v?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center",children:e.jsx(me,{className:"w-4 h-4 text-gray-400 cursor-grab active:cursor-grabbing"})}),e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center",children:r?e.jsx(De,{className:"w-4 h-4 text-gray-500"}):e.jsx(Me,{className:"w-4 h-4 text-gray-500"})}),e.jsxs("div",{className:"flex-1 flex items-center",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:s}),e.jsx(C,{variant:"secondary",className:"ml-auto",children:t.flatMap(n=>n.subtasks).filter(n=>{const l=O(n.nextMaintenance).label;return!g||l===g}).length})]})]}),!r&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50/50 border-b border-gray-200",children:[e.jsx(P,{label:"Task / Subtask",sortKey:"task",className:`px-3 py-2 text-left text-gray-700 w-[20%] ${v?.role==="admin"?"pl-[60px]":"pl-[36px]"}`}),e.jsx(P,{label:"Last Maintenance",sortKey:"lastMaintenance",className:"px-3 py-2 text-left text-gray-700 w-[12%]"}),e.jsx(P,{label:"Next Maintenance",sortKey:"nextMaintenance",className:"px-3 py-2 text-left text-gray-700 w-[12%]"}),v?.role!=="press"&&e.jsx("th",{className:"px-3 py-2 text-left text-gray-700 w-[8%]",children:"Interval"}),e.jsx(P,{label:"Status",sortKey:"status",className:"px-3 py-2 text-left text-gray-700 w-[8%]"}),e.jsx(P,{label:"Assigned To",sortKey:"assignedTo",className:"px-3 py-2 text-left text-gray-700 w-[12%]"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-700 w-[20%]",children:"Comment"}),v?.role==="admin"&&e.jsx("th",{className:"px-3 py-2 text-right text-gray-700 w-[8%]",children:"Actions"})]})}),e.jsx("tbody",{children:e.jsx(xs,{sensors:Te,collisionDetection:ms,onDragEnd:n=>Ke(n,s),children:e.jsx(hs,{items:ue(t).map(n=>n.id),strategy:gs,children:ue(t).map(n=>{const l=n.subtasks.filter(M=>g?O(M.nextMaintenance).label===g:!0);if(l.length===0)return null;const d=n.subtasks.length===1,x=K.has(n.id);return e.jsx(Ge,{groupedTask:n,isSingleTask:d,isGroupedTaskCollapsed:x,relevantSubtasks:l,user:v,toggleGroupedTask:Fe,onEditGroup:te,handleDelete:Le,getStatusInfo:O,formatDate:Ie,formatDateTime:Oe,formatInterval:Ue,handleQuickEdit:Pe,toMaintenanceTask:ge,onEdit:S,sortConfig:f},n.id)})})})})]})})]},s)})}),e.jsx(Cs,{open:!!V,onOpenChange:s=>!s&&c(null),task:V,field:j,onSave:D})]})}export{Ts as MaintenanceTable};
