import{c as ne,r as g,j as e,J as ce,M as ie,N as W,O as X,ad as I,ae as A,af as H,ag as J,U as de,R as U,Q as _,B as u,T as me,D as xe,b as oe,d as he,e as ue,f as pe,L as b,o as ge}from"./index-B9duk-qv.js";import{T as Y,a as Z,b as N,c as l,d as ee,e as r}from"./table-H2M43XPY.js";import{B as V}from"./badge-DLidOZg3.js";import{P as je,S as Ne}from"./square-pen-CpRoq3W_.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],fe=ne("calculator",ye),h=(y,t=0)=>{const c=typeof y=="string"?parseFloat(y):y;return isNaN(c)?y.toString():c.toLocaleString("nl-NL",{minimumFractionDigits:t,maximumFractionDigits:t})};function we({presses:y}){const t=y.filter(a=>a.active&&!a.archived).map(a=>a.name),[c,M]=g.useState(()=>{const a={};return t.forEach(s=>{a[s]={marge:0,margePercentage:"4,2",opstart:6e3,param_4_4:4e3,param_4_0:3e3,param_1_0:1500,param_1_1:2e3,param_4_1:3500}}),a}),[f,ae]=g.useState({marge:!1,margePercentage:!1,opstart:!1,param_4_4:!1,param_4_0:!1,param_1_0:!1,param_1_1:!1,param_4_1:!1}),E=(a,s,i)=>{if(f[s]){const d={...c};t.forEach(m=>{d[m]={...d[m],[s]:i}}),M(d)}else M({...c,[a]:{...c[a],[s]:i}})},L=a=>{const s=!f[a];if(ae({...f,[a]:s}),s&&t.length>0){const i=c[t[0]][a],d={...c};t.forEach(m=>{d[m]={...d[m],[a]:i}}),M(d)}},[C]=g.useState([{id:"1",date:"2025/12/01",datum:"01 Dec",orderNr:"ORD-001",orderName:"Magazine Q4",version:"v1",pages:32,exOmw:"1000",netRun:5e3,startup:!0,c4_4:32,c4_0:0,c1_0:0,c1_1:0,c4_1:0,maxGross:5500,green:100,red:50,performance:"95%"},{id:"2",date:"2025/12/02",datum:"02 Dec",orderNr:"ORD-002",orderName:"Flyers A5",version:"v1",pages:2,exOmw:"5000",netRun:1e4,startup:!1,c4_4:2,c4_0:0,c1_0:0,c1_1:0,c4_1:0,maxGross:10500,green:20,red:10,performance:"98%"}]),[k,B]=g.useState([{id:"main-cost-formula",name:"Max Bruto",formula:"IF(startup, Opstart * exOmw, 0) + netRun + (netRun * Marge) + (c4_4 * exOmw * param_4_4) + (c4_0 * exOmw * param_4_0) + (c1_0 * exOmw * param_1_0) + (c1_1 * exOmw * param_1_1) + (c4_1 * exOmw * param_4_1)"}]),[se,O]=g.useState(!1),[P,z]=g.useState(null),[w,D]=g.useState(""),[p,j]=g.useState(""),S=[{key:"pages",label:"Pagina's"},{key:"exOmw",label:"ex/omw."},{key:"netRun",label:"Oplage netto"},{key:"startup",label:"Opstart"},{key:"c4_4",label:"4/4"},{key:"c4_0",label:"4/0"},{key:"c1_0",label:"1/0"},{key:"c1_1",label:"1/1"},{key:"c4_1",label:"4/1"},{key:"maxGross",label:"Max Bruto"},{key:"green",label:"Groen"},{key:"red",label:"Rood"}],R=[{key:"Marge",label:"Marge"},{key:"Opstart",label:"Opstart"},{key:"param_4_4",label:"4/4"},{key:"param_4_0",label:"4/0"},{key:"param_1_0",label:"1/0"},{key:"param_1_1",label:"1/1"},{key:"param_4_1",label:"4/1"}],K=["+","-","*","/","(",")"],T=a=>{j(s=>s+" "+a)},Q=(a,s)=>{try{if(!a||!a.trim())return"N/A";const i=(n,F,o)=>n?F:o,d=t.length>0?t[0]:"",m=d?c[d]:{};let x=a;const v=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");S.forEach(n=>{const F=new RegExp(v(n.key),"g");let o=s[n.key];n.key==="startup"&&(o=o&&m.opstart||0),x=x.replace(F,String(o))}),R.forEach(n=>{const F=new RegExp(v(n.key),"g");let o=n.key;n.key==="Marge"&&(o="marge"),n.key==="Opstart"&&(o="opstart");let q=m[o]||0;o==="marge"&&(q=parseFloat((m.margePercentage||"0").replace(",","."))||0),x=x.replace(F,String(q))});const G=Function("IF",'"use strict"; return ('+x+")")(i);return typeof G=="number"?(Math.round(G*100)/100).toLocaleString("nl-NL",{minimumFractionDigits:0,maximumFractionDigits:2}):G}catch(i){return console.error("Formula evaluation error:",i),"Error"}},$=a=>{a?(z(a),D(a.name),j(a.formula)):(z(null),D(""),j("")),O(!0)},re=()=>{if(!(!w.trim()||!p.trim())){if(P)B(k.map(a=>a.id===P.id?{...a,name:w,formula:p}:a));else{const a={id:Date.now().toString(),name:w,formula:p};B([...k,a])}O(!1),D(""),j(""),z(null)}},le=a=>{B(k.filter(s=>s.id!==a))},te=C.length>0?Q(p,C[0]):"N/A";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ce,{defaultValue:"finished",className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(W,{value:"finished",children:"Finished"}),e.jsx(W,{value:"parameters",children:"Parameters"})]}),e.jsx(X,{value:"finished",children:e.jsxs(I,{children:[e.jsx(A,{children:e.jsx(H,{children:"Finished Print Jobs"})}),e.jsx(J,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsxs(N,{children:[e.jsx(l,{colSpan:8,className:"text-center bg-blue-100",children:"Data"}),e.jsx(l,{colSpan:6,className:"text-center bg-green-100",children:"Wissels"}),e.jsx(l,{colSpan:3,className:"text-center bg-yellow-100",children:"Berekening"}),e.jsx(l,{colSpan:1,className:"text-center bg-purple-100",children:"Prestatie"})]}),e.jsxs(N,{children:[e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Datum"}),e.jsx(l,{children:"Order nr"}),e.jsx(l,{children:"Order"}),e.jsx(l,{children:"Versie"}),e.jsx(l,{children:"Pagina's"}),e.jsx(l,{children:"ex/omw."}),e.jsx(l,{children:"Oplage netto"}),e.jsx(l,{children:"Opstart"}),e.jsx(l,{children:"4/4"}),e.jsx(l,{children:"4/0"}),e.jsx(l,{children:"1/0"}),e.jsx(l,{children:"1/1"}),e.jsx(l,{children:"4/1"}),e.jsx(l,{children:"Max Bruto"}),e.jsx(l,{children:"Groen"}),e.jsx(l,{children:"Rood"}),e.jsx(l,{children:"Prestatie"})]})]}),e.jsx(ee,{children:C.map(a=>e.jsxs(N,{children:[e.jsx(r,{children:a.date}),e.jsx(r,{children:a.datum}),e.jsx(r,{children:a.orderNr}),e.jsx(r,{children:a.orderName}),e.jsx(r,{children:a.version}),e.jsx(r,{children:h(a.pages)}),e.jsx(r,{children:a.exOmw}),e.jsx(r,{children:h(a.netRun)}),e.jsx(r,{children:e.jsx("div",{className:"flex justify-center",children:a.startup?e.jsx(de,{className:"w-4 h-4 text-green-600"}):e.jsx("span",{className:"text-gray-300",children:"-"})})}),e.jsx(r,{children:h(a.c4_4)}),e.jsx(r,{children:h(a.c4_0)}),e.jsx(r,{children:h(a.c1_0)}),e.jsx(r,{children:h(a.c1_1)}),e.jsx(r,{children:h(a.c4_1)}),e.jsx(r,{children:h(a.maxGross)}),e.jsx(r,{children:h(a.green)}),e.jsx(r,{children:h(a.red)}),e.jsx(r,{children:a.performance})]},a.id))})]})})})]})}),e.jsx(X,{value:"parameters",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(I,{children:[e.jsx(A,{children:e.jsx(H,{children:"Parameters"})}),e.jsxs(J,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(N,{children:[e.jsx(l,{className:"w-[200px]",children:"Parameter"}),e.jsx(l,{className:"w-[50px] text-center",children:"Link"}),t.map(a=>e.jsx(l,{className:"text-center min-w-[120px]",children:a},a))]})}),e.jsxs(ee,{children:[e.jsxs(N,{children:[e.jsx(r,{className:"font-medium",children:"Marge"}),e.jsx(r,{className:"text-center",children:e.jsx(U,{checked:f.margePercentage,onCheckedChange:()=>L("margePercentage")})}),t.map(a=>e.jsx(r,{children:e.jsx("div",{className:"flex gap-2",children:e.jsx(_,{type:"text",placeholder:"%",className:"h-8",value:c[a]?.margePercentage||"",onChange:s=>E(a,"margePercentage",s.target.value)})})},a))]}),e.jsxs(N,{children:[e.jsx(r,{className:"font-medium",children:"Opstart"}),e.jsx(r,{className:"text-center",children:e.jsx(U,{checked:f.opstart,onCheckedChange:()=>L("opstart")})}),t.map(a=>e.jsx(r,{className:"text-center",children:e.jsx(_,{type:"number",className:"h-8",value:c[a]?.opstart||0,onChange:s=>E(a,"opstart",Number(s.target.value))})},a))]}),[{id:"param_4_4",label:"4/4"},{id:"param_4_0",label:"4/0"},{id:"param_1_0",label:"1/0"},{id:"param_1_1",label:"1/1"},{id:"param_4_1",label:"4/1"}].map(a=>e.jsxs(N,{children:[e.jsx(r,{className:"font-medium",children:a.label}),e.jsx(r,{className:"text-center",children:e.jsx(U,{checked:f[a.id],onCheckedChange:()=>L(a.id)})}),t.map(s=>e.jsx(r,{children:e.jsx(_,{type:"number",className:"h-8",value:c[s]?.[a.id]||0,onChange:i=>E(s,a.id,Number(i.target.value))})},s))]},a.id))]})]})}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(u,{children:"Save Changes"})})]})]}),e.jsxs(I,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsx(H,{children:"Calculated Fields"}),e.jsxs(u,{onClick:()=>$(),className:"gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Add Formula"]})]}),e.jsx(J,{children:k.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:'No calculated fields yet. Click "Add Formula" to create one.'}):e.jsx("div",{className:"space-y-2",children:k.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600 font-mono",children:a.formula}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Preview: ",Q(a.formula,C[0])]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>$(a),children:e.jsx(Ne,{className:"w-4 h-4"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>le(a.id),children:e.jsx(me,{className:"w-4 h-4 text-red-500"})})]})]},a.id))})})]})]})})]}),e.jsx(xe,{open:se,onOpenChange:O,children:e.jsxs(oe,{className:"max-w-2xl",children:[e.jsxs(he,{children:[e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),P?"Edit Formula":"Create Calculated Field"]}),e.jsx(pe,{children:"Build a formula by clicking on fields, operators, and numbers below."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"formula-name",children:"Field Name *"}),e.jsx(_,{id:"formula-name",placeholder:"e.g., Total Cost",value:w,onChange:a=>D(a.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{children:"Formula"}),e.jsx(_,{value:p,onChange:a=>j(a.target.value),placeholder:"Type or click fields below to build formula...",className:"font-mono"}),e.jsx("div",{className:"p-3 border rounded-md bg-gray-50 min-h-[60px] flex flex-wrap gap-2 items-center",children:p?p.split(" ").filter(a=>a).map((a,s)=>{const i=S.some(x=>x.key===a)||R.some(x=>x.key===a),d=K.includes(a),m=!isNaN(Number(a))&&a!=="";if(i){const x=S.find(v=>v.key===a)||R.find(v=>v.key===a);return e.jsx(V,{variant:"outline",className:"bg-blue-50 border-blue-200",children:x?.label||a},s)}else return d?e.jsx("span",{className:"px-2 py-1 bg-gray-200 rounded font-mono text-sm",children:a},s):m?e.jsx("span",{className:"px-2 py-1 bg-green-50 border border-green-200 rounded font-mono text-sm",children:a},s):e.jsx("span",{className:"font-mono text-sm",children:a},s)}):e.jsx("span",{className:"text-gray-400 text-sm",children:"Formula will appear here..."})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Clear"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>j(a=>a.trim().split(" ").slice(0,-1).join(" ")),children:"Remove Last"})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-xs text-gray-600",children:"Finished Job Fields"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:S.map(a=>e.jsx(V,{variant:"outline",className:"cursor-pointer hover:bg-blue-100",onClick:()=>T(a.key),children:a.label},a.key))})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xs text-gray-600",children:"Parameters"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:R.map(a=>e.jsx(V,{variant:"outline",className:"cursor-pointer hover:bg-green-100",onClick:()=>T(a.key),children:a.label},a.key))})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xs text-gray-600",children:"Operators"}),e.jsx("div",{className:"flex gap-2 mt-2",children:K.map(a=>e.jsx(u,{variant:"outline",size:"sm",onClick:()=>T(a),className:"w-10",children:a},a))})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xs text-gray-600",children:"Number"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(_,{type:"number",placeholder:"Enter number",className:"w-32",onKeyDown:a=>{a.key==="Enter"&&(T(a.target.value),a.target.value="")}}),e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Press Enter to add"})]})]})]}),e.jsxs("div",{className:"p-3 border rounded-md bg-blue-50",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Preview Result"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 mt-1",children:te}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Using first job data with sample parameter values"})]})]}),e.jsxs(ge,{children:[e.jsx(u,{variant:"outline",onClick:()=>O(!1),children:"Cancel"}),e.jsx(u,{onClick:re,disabled:!w.trim()||!p.trim(),children:P?"Update Formula":"Save Formula"})]})]})})]})}export{we as Drukwerken};
