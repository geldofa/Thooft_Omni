import{c as _e,j as e,a as Je,u as Ke,r as y,D as Xe,b as Ze,d as es,e as ss,f as ts,L as re,P as as,g as ns,B as g,C as L,h as rs,i as ls,k as is,t as ye,l as cs,m as ze,G as De,n as Le,o as Be,p as ds,q as os,S as xs,v as ms,s as hs,w as gs,K as ps,x as js,y as us,z as ys,T as le}from"./index-BIS4mEZ5.js";import{C as ie}from"./checkbox-mUKh-oNp.js";import{B as I}from"./badge-BVidjdNH.js";import{A as ce,a as de,b as oe,c as xe,d as me,e as he,f as ge,g as pe,h as je}from"./alert-dialog-BZWYbSJG.js";import{P as Ns,S as ue}from"./square-pen-Cv7Cmfe7.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Me=_e("user",fs);function bs({className:B,...U}){return e.jsx("textarea",{"data-slot":"textarea",className:Je("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",B),...U})}function vs({open:B,onOpenChange:U,task:x,siblingTasks:$=[],field:K,onSave:Z}){const ee=Ke(),{operators:C,ploegen:G,externalEntities:se}=ee,[T,te]=y.useState(null),[q,ae]=y.useState(""),[F,H]=y.useState([]),[E,O]=y.useState(new Set),P=$.length>1;y.useEffect(()=>{if(x){if(te(x.lastMaintenance),ae(x.opmerkingen),x.assignedToIds&&x.assignedToTypes){const t=x.assignedToIds.map((l,d)=>({id:l,type:x.assignedToTypes?.[d]||"operator"}));H(t)}else H([]);P&&O(new Set([x.id]))}},[x,P]);const Ne=()=>{const t=new Set(G.filter(l=>l.active).flatMap(l=>l.operatorIds));return C.filter(l=>l.active&&!t.has(l.id))},V=()=>{if(!x)return{ploegen:[],operators:[],externalEntities:[]};const t=x.press;return{ploegen:G.filter(l=>l.active&&l.presses.includes(t)),operators:Ne().filter(l=>l.presses.includes(t)),externalEntities:se.filter(l=>l.active&&l.presses.includes(t))}},R=(t,l)=>{H(d=>d.some(f=>f.id===t&&f.type===l)?d.filter(f=>!(f.id===t&&f.type===l)):[...d,{id:t,type:l}])},h=(t,l)=>F.some(d=>d.id===t&&d.type===l),fe=t=>{O(l=>{const d=new Set(l);if(d.has(t)){if(t===x?.id)return l;d.delete(t)}else d.add(t);return d})},b=()=>{O(new Set($.map(t=>t.id)))},Y=()=>{x&&O(new Set([x.id]))},v=V(),_=()=>{if(!x)return;const t=F.map(o=>o.id),l=F.map(o=>o.type),d=F.map(o=>o.type==="ploeg"?G.find(M=>M.id===o.id)?.name:o.type==="operator"?C.find(M=>M.id===o.id)?.name:o.type==="external"?se.find(M=>M.id===o.id)?.name:"").filter(Boolean).join(", "),D=P?$.filter(o=>E.has(o.id)):[x];for(const o of D){const M={...o,lastMaintenance:T,assignedTo:d,assignedToIds:t,assignedToTypes:l,opmerkingen:q,commentDate:q!==o.opmerkingen?new Date:o.commentDate,nextMaintenance:K==="lastMaintenance"&&T?(()=>{const k=new Date(T);switch(o.maintenanceIntervalUnit){case"days":k.setDate(k.getDate()+o.maintenanceInterval);break;case"weeks":k.setDate(k.getDate()+o.maintenanceInterval*7);break;case"months":k.setMonth(k.getMonth()+o.maintenanceInterval);break}return k})():o.nextMaintenance};Z(M)}const f=D.length;ye.success(f>1?`Updated ${f} tasks successfully`:"Task updated successfully"),U(!1)},be=t=>{if(!t)return"Pick a date";const l=new Date(t),d=l.getFullYear(),D=String(l.getMonth()+1).padStart(2,"0"),f=String(l.getDate()).padStart(2,"0");return`${d}/${D}/${f}`};return x?e.jsx(Xe,{open:B,onOpenChange:U,children:e.jsxs(Ze,{className:"!max-w-[800px] sm:!max-w-[800px] max-h-[90vh] overflow-y-auto",style:{maxWidth:"800px"},children:[e.jsxs(es,{children:[e.jsx(ss,{children:K==="lastMaintenance"?"Update Last Maintenance":"Update Opmerkingen"}),e.jsx(ts,{children:K==="lastMaintenance"?"Update the last maintenance date and who performed it.":"Update the maintenance notes."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[K==="lastMaintenance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(re,{children:"Last Maintenance Date"}),e.jsxs(as,{children:[e.jsx(ns,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"justify-start text-left",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),be(T)]})}),e.jsx(rs,{className:"w-auto p-0",align:"start",children:e.jsx(ls,{mode:"single",selected:T||void 0,onSelect:t=>te(t||null),initialFocus:!0})})]})]}),P&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(re,{children:"Apply to Child Tasks"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:b,children:"Select All"}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",onClick:Y,children:"Deselect All"})]})]}),e.jsx("div",{className:"border rounded-md p-3 bg-gray-50/50",children:e.jsx("div",{className:`grid gap-3 ${$.length>=4?"grid-cols-4":$.length===3?"grid-cols-3":"grid-cols-2"}`,children:$.map(t=>e.jsxs("div",{className:`flex items-start space-x-2 px-3 py-2 rounded-md border ${E.has(t.id)?"bg-blue-50 border-blue-200":"bg-white border-gray-200"} ${t.id===x.id?"ring-2 ring-blue-400":""}`,children:[e.jsx(ie,{id:`sibling-${t.id}`,checked:E.has(t.id),onCheckedChange:()=>fe(t.id),disabled:t.id===x.id,className:"mt-0.5"}),e.jsxs("label",{htmlFor:`sibling-${t.id}`,className:"cursor-pointer select-none",children:[e.jsx("div",{className:"text-sm font-medium",children:t.task}),t.taskSubtext&&e.jsx("div",{className:"text-xs text-gray-500",children:t.taskSubtext})]})]},t.id))})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(re,{children:"Assigned To"}),e.jsxs("div",{className:"border rounded-md p-4 max-h-[300px] overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider",children:"Ploegen"}),v.ploegen.length>0?e.jsx("div",{className:"flex flex-wrap gap-4",children:v.ploegen.map(t=>e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50/50",style:{flex:"1 1 calc(33.333% - 0.75rem)",minWidth:"150px"},children:[e.jsx("div",{className:"font-medium text-sm text-gray-700 mb-2 pb-1 border-b border-gray-200 truncate",title:t.name,children:t.name}),e.jsx("div",{className:"space-y-2",children:t.operatorIds.map(l=>{const d=C.find(D=>D.id===l);return d?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ie,{id:`ploeg-member-${d.id}`,checked:h(d.id,"operator"),onCheckedChange:()=>R(d.id,"operator")}),e.jsx("label",{htmlFor:`ploeg-member-${d.id}`,className:"text-sm text-gray-600 cursor-pointer select-none",children:d.name})]},d.id):null})})]},t.id))}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No ploegen available"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50/50",style:{flex:"1 1 calc(50% - 0.5rem)",minWidth:"200px"},children:[e.jsx("div",{className:"font-medium text-sm text-gray-700 mb-2 pb-1 border-b border-gray-200",children:"Operators"}),v.operators.length>0?e.jsx("div",{className:"space-y-1",children:v.operators.map(t=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-md",children:[e.jsx(ie,{id:`op-${t.id}`,checked:h(t.id,"operator"),onCheckedChange:()=>R(t.id,"operator")}),e.jsx("label",{htmlFor:`op-${t.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:t.name})]},t.id))}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No operators available"})]}),e.jsxs("div",{className:"border rounded-md p-3 bg-gray-50/50",style:{flex:"1 1 calc(50% - 0.5rem)",minWidth:"200px"},children:[e.jsx("div",{className:"font-medium text-sm text-gray-700 mb-2 pb-1 border-b border-gray-200",children:"External"}),v.externalEntities.length>0?e.jsx("div",{className:"space-y-1",children:v.externalEntities.map(t=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-md",children:[e.jsx(ie,{id:`ext-${t.id}`,checked:h(t.id,"external"),onCheckedChange:()=>R(t.id,"external")}),e.jsx("label",{htmlFor:`ext-${t.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:t.name})]},t.id))}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No external entities"})]})]}),v.ploegen.length===0&&v.operators.length===0&&v.externalEntities.length===0&&e.jsxs("p",{className:"text-sm text-gray-500 text-center py-4",children:["No assignees available for ",x.press]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(re,{children:"Opmerkingen"}),e.jsx(bs,{value:q,onChange:t=>ae(t.target.value),rows:4,placeholder:"Add maintenance notes..."})]})]}),e.jsxs(is,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Cancel"}),e.jsx(g,{type:"button",onClick:_,children:P&&E.size>1?`Save Changes (${E.size} tasks)`:"Save Changes"})]})]})}):null}function As({tasks:B,onEdit:U,onDelete:x,onUpdate:$,onEditGroup:K,onAddTask:Z,onUpdateTaskOrder:ee}){const{user:C,categoryOrder:G,updateCategoryOrder:se}=Ke(),[T,te]=y.useState(new Set),[q,ae]=y.useState(new Set),[F,H]=y.useState(null),[E,O]=y.useState([]),[P,Ne]=y.useState("lastMaintenance"),[V,R]=y.useState(null),[h,fe]=y.useState(null),[b,Y]=y.useState(null),v=cs(ze(js),ze(ps,{coordinateGetter:gs})),_=(s,n)=>({id:s.id,task:s.subtaskName,taskSubtext:s.subtext,category:n.category,press:n.press,lastMaintenance:s.lastMaintenance,nextMaintenance:s.nextMaintenance,maintenanceInterval:s.maintenanceInterval,maintenanceIntervalUnit:s.maintenanceIntervalUnit,assignedTo:s.assignedTo,opmerkingen:s.comment,commentDate:s.commentDate,created:new Date().toISOString(),updated:new Date().toISOString()}),be=s=>{if(!s)return"N/A";const n=new Date(s),i=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0");return`${i}/${r}/${c}`},t=s=>{if(!s)return"N/A";const n=new Date(s),i=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),c=String(n.getDate()).padStart(2,"0"),p=String(n.getHours()).padStart(2,"0"),j=String(n.getMinutes()).padStart(2,"0");return`${i}/${r}/${c} ${p}:${j}`},l=(s,n)=>`${s} ${n}`,d=s=>{const n=new Date,i=new Date(s),r=Math.ceil((i.getTime()-n.getTime())/(1e3*60*60*24));return r<0?{label:"Overdue",color:"bg-red-50",textColor:"text-red-700",badgeClass:"bg-red-500 hover:bg-red-600"}:r<=7?{label:"Due Soon",color:"bg-orange-50",textColor:"text-orange-700",badgeClass:"bg-orange-500 hover:bg-orange-600"}:r<=30?{label:"Upcoming",color:"bg-yellow-50",textColor:"text-yellow-700",badgeClass:"bg-yellow-500 hover:bg-yellow-600"}:{label:"Scheduled",color:"",textColor:"",badgeClass:"bg-gray-200 hover:bg-gray-300 text-gray-700"}},D=s=>{const n=new Set(T);n.has(s)?n.delete(s):n.add(s),te(n)},f=s=>{const n=new Set(q);n.has(s)?n.delete(s):n.add(s),ae(n)},o=(s,n,i)=>{H(_(s,n)),O(n.subtasks.map(r=>_(r,n))),Ne(i)},M=(s,n)=>{x(s),ye.success(`${n} deleted successfully`)},k=s=>{R(s)},Ge=(s,n)=>{if(s.preventDefault(),V&&V!==n){const i=[...G],r=i.indexOf(V),c=i.indexOf(n);i.splice(r,1),i.splice(c,0,V),se(i)}},qe=()=>{R(null)},He=async(s,n)=>{const{active:i,over:r}=s;if(r&&i.id!==r.id){const c=ve[n],p=c.findIndex(N=>N.id===i.id),j=c.findIndex(N=>N.id===r.id),A=hs(c,p,j).map(N=>N.id);if(ee)try{await ee(n,A),ye.success("Task order updated")}catch{ye.error("Failed to update task order")}}},W=B.flatMap(s=>s.subtasks).reduce((s,n)=>{const i=d(n.nextMaintenance).label;return i!=="Scheduled"&&(s[i]=(s[i]||0)+1),s},{}),ve=B.reduce((s,n)=>(s[n.category]||(s[n.category]=[]),s[n.category].push(n),s),{}),ke=G.filter(s=>ve[s]?.length>0),we=s=>{fe(h===s?null:s)},Ve=s=>{b?.key===s?b.direction==="asc"?Y({key:s,direction:"desc"}):Y(null):Y({key:s,direction:"asc"})},Ae=s=>b?[...s].sort((n,i)=>{let r,c;const p=n.subtasks[0],j=i.subtasks[0];switch(b.key){case"task":r=n.taskName.toLowerCase(),c=i.taskName.toLowerCase();break;case"lastMaintenance":r=p?.lastMaintenance?new Date(p.lastMaintenance).getTime():0,c=j?.lastMaintenance?new Date(j.lastMaintenance).getTime():0;break;case"nextMaintenance":r=p?.nextMaintenance?new Date(p.nextMaintenance).getTime():0,c=j?.nextMaintenance?new Date(j.nextMaintenance).getTime():0;break;case"status":r=d(p?.nextMaintenance).label,c=d(j?.nextMaintenance).label;break;case"assignedTo":r=p?.assignedTo?.toLowerCase()||"",c=j?.assignedTo?.toLowerCase()||"";break;default:return 0}return r<c?b.direction==="asc"?-1:1:r>c?b.direction==="asc"?1:-1:0}):s,J=({label:s,sortKey:n,className:i="px-3 py-2 text-left text-gray-700"})=>{const r=b?.key===n;return e.jsx("th",{className:i,children:e.jsxs("button",{onClick:()=>Ve(n),className:"flex items-center gap-1 hover:text-gray-900 transition-colors w-full",children:[e.jsx("span",{children:s}),r&&e.jsx("span",{className:"text-xs text-blue-600",children:b.direction==="asc"?"↑":"↓"})]})})};function Re({groupedTask:s,isSingleTask:n,isGroupedTaskCollapsed:i,relevantSubtasks:r,user:c,toggleGroupedTask:p,onEditGroup:j,handleDelete:z,getStatusInfo:A,formatDate:N,formatDateTime:Se,formatInterval:Ce,handleQuickEdit:ne,toMaintenanceTask:$e,onEdit:Te,sortConfig:X}){const{attributes:Ie,listeners:Ue,setNodeRef:Fe,transform:We,transition:Qe,isDragging:Ye}=us({id:s.id}),Ee={transform:ys.Transform.toString(We),transition:Qe,opacity:Ye?.8:1},Oe=y.useMemo(()=>X?[...r].sort((a,m)=>{let S,u;switch(X.key){case"task":S=a.subtaskName.toLowerCase(),u=m.subtaskName.toLowerCase();break;case"lastMaintenance":S=a.lastMaintenance?new Date(a.lastMaintenance).getTime():0,u=m.lastMaintenance?new Date(m.lastMaintenance).getTime():0;break;case"nextMaintenance":S=a.nextMaintenance?new Date(a.nextMaintenance).getTime():0,u=m.nextMaintenance?new Date(m.nextMaintenance).getTime():0;break;case"status":S=A(a.nextMaintenance).label,u=A(m.nextMaintenance).label;break;case"assignedTo":S=a.assignedTo?.toLowerCase()||"",u=m.assignedTo?.toLowerCase()||"";break;default:return 0}return S<u?X.direction==="asc"?-1:1:S>u?X.direction==="asc"?1:-1:0}):r,[r,X,A]),w=y.useMemo(()=>r.length===0?null:r.reduce((a,m)=>a.nextMaintenance?m.nextMaintenance?new Date(a.nextMaintenance)<new Date(m.nextMaintenance)?a:m:a:m),[r]),Q=w?A(w.nextMaintenance):null,Pe=Q&&Q.label!=="Scheduled"?Q.color:"";return e.jsxs(e.Fragment,{children:[!n&&e.jsxs("tr",{ref:Fe,style:Ee,className:`bg-gray-50 border-b border-gray-100 ${i&&Pe?Pe:""}`,children:[e.jsx("td",{colSpan:i?1:c?.role==="admin"?8:c?.role==="press"?6:7,className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-start",children:[c?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center mt-1",children:e.jsx("button",{type:"button",className:"cursor-grab active:cursor-grabbing text-gray-400 hover:text-gray-600 touch-none",...Ie,...Ue,children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center mt-1",children:e.jsx("button",{onClick:()=>p(s.id),className:"text-gray-500 hover:text-gray-700",children:i?e.jsx(Le,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})})}),e.jsx("div",{className:"flex-1",children:e.jsxs("button",{className:"text-left w-full",onClick:()=>p(s.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.taskName}),e.jsxs(I,{variant:"secondary",className:"ml-2",children:[r.length," subtasks"]})]}),s.taskSubtext&&e.jsx("div",{className:"text-gray-500 text-xs mt-0.5",children:s.taskSubtext})]})}),c?.role==="admin"&&!i&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),j?.(s)},children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:a=>a.stopPropagation(),children:e.jsx(le,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(oe,{children:[e.jsxs(xe,{children:[e.jsx(me,{children:"Delete Grouped Task"}),e.jsxs(he,{children:['Are you sure you want to delete "',s.taskName,'" and all its subtasks?']})]}),e.jsxs(ge,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(je,{onClick:()=>z(s.id,s.taskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})]})}),i&&w&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:N(w.lastMaintenance)})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(L,{className:"w-4 h-4"}),N(w.nextMaintenance)]})}),c?.role!=="press"&&e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:"text-gray-600",children:Ce(w.maintenanceInterval,w.maintenanceIntervalUnit)})}),e.jsx("td",{className:"px-3 py-1.5",children:Q&&e.jsx(I,{className:Q.badgeClass,children:Q.label})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:w.assignedTo})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"line-clamp-2 text-gray-600",children:w.comment}),w.commentDate&&e.jsx("div",{className:"text-gray-400 text-xs",children:Se(w.commentDate)})]})}),c?.role==="admin"&&e.jsx("td",{className:"px-3 py-1.5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),j?.(s)},children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:a=>a.stopPropagation(),children:e.jsx(le,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(oe,{children:[e.jsxs(xe,{children:[e.jsx(me,{children:"Delete Grouped Task"}),e.jsxs(he,{children:['Are you sure you want to delete "',s.taskName,'" and all its subtasks?']})]}),e.jsxs(ge,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(je,{onClick:()=>z(s.id,s.taskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]})]}),n&&Oe.map(a=>{const m=A(a.nextMaintenance),S=m.label!=="Scheduled"?m.color:"";return e.jsxs("tr",{ref:Fe,style:Ee,className:`border-b border-gray-100 last:border-0 hover:bg-gray-50/50 ${S}`,children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-start",children:[c?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center mt-1",children:e.jsx("button",{type:"button",className:"cursor-grab active:cursor-grabbing text-gray-400 hover:text-gray-600 touch-none",...Ie,...Ue,children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsx("div",{className:"w-6 flex-shrink-0"}),e.jsxs("div",{className:"max-w-xs flex-1",children:[e.jsx("div",{className:"line-clamp-2",children:a.subtaskName}),a.subtext&&e.jsx("div",{className:"text-gray-500 text-xs line-clamp-1",children:a.subtext})]})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>ne(a,s,"lastMaintenance"),children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:N(a.lastMaintenance)})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(L,{className:"w-4 h-4"}),N(a.nextMaintenance)]})}),c?.role!=="press"&&e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:"text-gray-600",children:Ce(a.maintenanceInterval,a.maintenanceIntervalUnit)})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx(I,{className:m.badgeClass,children:m.label})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.assignedTo})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>ne(a,s,"opmerkingen"),children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"line-clamp-2 text-gray-600",children:a.comment||"Click to add..."}),a.commentDate&&e.jsx("div",{className:"text-gray-400 text-xs",children:Se(a.commentDate)})]})}),c?.role==="admin"&&e.jsx("td",{className:"px-3 py-1.5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:u=>{u.stopPropagation(),Te($e(a,s))},children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:u=>u.stopPropagation(),children:e.jsx(le,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(oe,{children:[e.jsxs(xe,{children:[e.jsx(me,{children:"Delete Subtask"}),e.jsxs(he,{children:['Are you sure you want to delete "',a.subtaskName,'"? This action cannot be undone.']})]}),e.jsxs(ge,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(je,{onClick:()=>z(a.id,a.subtaskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]},a.id)}),!n&&!i&&Oe.map(a=>{const m=A(a.nextMaintenance),S=m.label!=="Scheduled"?m.color:"";return e.jsxs("tr",{className:`border-b border-gray-100 last:border-0 hover:bg-gray-50/50 ${S}`,children:[e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-start",children:[c?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0"}),e.jsx("div",{className:"w-6 flex-shrink-0"}),e.jsxs("div",{className:"max-w-xs flex-1",children:[e.jsx("div",{className:"line-clamp-2",children:a.subtaskName}),a.subtext&&e.jsx("div",{className:"text-gray-500 text-xs line-clamp-1",children:a.subtext})]})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>ne(a,s,"lastMaintenance"),children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:N(a.lastMaintenance)})]})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(L,{className:"w-4 h-4"}),N(a.nextMaintenance)]})}),c?.role!=="press"&&e.jsx("td",{className:"px-3 py-1.5",children:e.jsx("span",{className:"text-gray-600",children:Ce(a.maintenanceInterval,a.maintenanceIntervalUnit)})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsx(I,{className:m.badgeClass,children:m.label})}),e.jsx("td",{className:"px-3 py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:a.assignedTo})]})}),e.jsx("td",{className:"px-3 py-1.5 cursor-pointer hover:bg-gray-100/50 transition-colors",onClick:()=>ne(a,s,"opmerkingen"),children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"line-clamp-2 text-gray-600",children:a.comment||"Click to add..."}),a.commentDate&&e.jsx("div",{className:"text-gray-400 text-xs",children:Se(a.commentDate)})]})}),c?.role==="admin"&&e.jsx("td",{className:"px-3 py-1.5 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:u=>{u.stopPropagation(),Te($e(a,s))},children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",onClick:u=>u.stopPropagation(),children:e.jsx(le,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(oe,{children:[e.jsxs(xe,{children:[e.jsx(me,{children:"Delete Subtask"}),e.jsxs(he,{children:['Are you sure you want to delete "',a.subtaskName,'"? This action cannot be undone.']})]}),e.jsxs(ge,{children:[e.jsx(pe,{children:"Cancel"}),e.jsx(je,{onClick:()=>z(a.id,a.subtaskName),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]},a.id)})]})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Maintenance Tasks"}),e.jsxs("div",{className:"flex items-center gap-2",children:[W.Overdue>0&&e.jsxs(g,{variant:h==="Overdue"?"default":"outline",size:"sm",onClick:()=>we("Overdue"),className:"gap-2",children:[e.jsx("span",{className:h==="Overdue"?"text-white":"text-red-600",children:"Overdue"}),e.jsx(I,{variant:h==="Overdue"?"secondary":"default",className:"bg-red-500",children:W.Overdue})]}),W["Due Soon"]>0&&e.jsxs(g,{variant:h==="Due Soon"?"default":"outline",size:"sm",onClick:()=>we("Due Soon"),className:"gap-2",children:[e.jsx("span",{className:h==="Due Soon"?"text-white":"text-orange-600",children:"Due Soon"}),e.jsx(I,{variant:h==="Due Soon"?"secondary":"default",className:"bg-orange-500",children:W["Due Soon"]})]}),W.Upcoming>0&&e.jsxs(g,{variant:h==="Upcoming"?"default":"outline",size:"sm",onClick:()=>we("Upcoming"),className:"gap-2",children:[e.jsx("span",{className:h==="Upcoming"?"text-white":"text-yellow-600",children:"Upcoming"}),e.jsx(I,{variant:h==="Upcoming"?"secondary":"default",className:"bg-yellow-500",children:W.Upcoming})]})]}),Z&&e.jsxs(g,{onClick:Z,size:"sm",className:"gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Add Task"]})]}),e.jsx("div",{className:"space-y-3",children:ke.length===0?e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm p-12 text-center text-gray-500",children:"No maintenance tasks found. Add your first task to get started."}):ke.map(s=>{const n=ve[s],i=T.has(s);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center px-3 py-2 bg-gray-50 border-b border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>D(s),draggable:C?.role==="admin",onDragStart:()=>k(s),onDragOver:r=>Ge(r,s),onDragEnd:qe,children:[C?.role==="admin"&&e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center",children:e.jsx(De,{className:"w-4 h-4 text-gray-400 cursor-grab active:cursor-grabbing"})}),e.jsx("div",{className:"w-6 flex-shrink-0 flex justify-center",children:i?e.jsx(Le,{className:"w-4 h-4 text-gray-500"}):e.jsx(Be,{className:"w-4 h-4 text-gray-500"})}),e.jsxs("div",{className:"flex-1 flex items-center",children:[e.jsx("span",{className:"text-gray-900 font-medium",children:s}),e.jsx(I,{variant:"secondary",className:"ml-auto",children:n.flatMap(r=>r.subtasks).filter(r=>{const c=d(r.nextMaintenance).label;return!h||c===h}).length})]})]}),!i&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50/50 border-b border-gray-200",children:[e.jsx(J,{label:"Task / Subtask",sortKey:"task",className:`px-3 py-2 text-left text-gray-700 w-[20%] ${C?.role==="admin"?"pl-[60px]":"pl-[36px]"}`}),e.jsx(J,{label:"Last Maintenance",sortKey:"lastMaintenance",className:"px-3 py-2 text-left text-gray-700 w-[12%]"}),e.jsx(J,{label:"Next Maintenance",sortKey:"nextMaintenance",className:"px-3 py-2 text-left text-gray-700 w-[12%]"}),C?.role!=="press"&&e.jsx("th",{className:"px-3 py-2 text-left text-gray-700 w-[8%]",children:"Interval"}),e.jsx(J,{label:"Status",sortKey:"status",className:"px-3 py-2 text-left text-gray-700 w-[8%]"}),e.jsx(J,{label:"Assigned To",sortKey:"assignedTo",className:"px-3 py-2 text-left text-gray-700 w-[12%]"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-700 w-[20%]",children:"Comment"}),C?.role==="admin"&&e.jsx("th",{className:"px-3 py-2 text-right text-gray-700 w-[8%]",children:"Actions"})]})}),e.jsx("tbody",{children:e.jsx(ds,{sensors:v,collisionDetection:os,onDragEnd:r=>He(r,s),children:e.jsx(xs,{items:Ae(n).map(r=>r.id),strategy:ms,children:Ae(n).map(r=>{const c=r.subtasks.filter(z=>h?d(z.nextMaintenance).label===h:!0);if(c.length===0)return null;const p=r.subtasks.length===1,j=q.has(r.id);return e.jsx(Re,{groupedTask:r,isSingleTask:p,isGroupedTaskCollapsed:j,relevantSubtasks:c,user:C,toggleGroupedTask:f,onEditGroup:K,handleDelete:M,getStatusInfo:d,formatDate:be,formatDateTime:t,formatInterval:l,handleQuickEdit:o,toMaintenanceTask:_,onEdit:U,sortConfig:b},r.id)})})})})]})})]},s)})}),e.jsx(vs,{open:!!F,onOpenChange:s=>{s||(H(null),O([]))},task:F,siblingTasks:E,field:P,onSave:$})]})}export{As as MaintenanceTable};
