import{u as G,r as d,j as e,B as n,I as P,J as K,T as Q,D as V,b as W,d as X,e as Y,f as Z,L as w,k as _,t as o}from"./index-CwTnel9m.js";import{T as ee,a as se,b as D,c as u,d as ae,e as g}from"./table-CfCx2tIt.js";import{B as F}from"./badge-QOA62ud8.js";import{A as te,a as re,b as ne,c as ie,d as le,e as de,f as ce,g as oe,h as he}from"./alert-dialog-DwD5XulD.js";import{S as U}from"./switch--NxzUwwm.js";import{C as M}from"./checkbox-CPeOMEHc.js";import{P as me,S as ge}from"./square-pen-B3L_37BE.js";function Ce(){const{categories:x,addCategory:O,updateCategory:A,deleteCategory:B,addActivityLog:j,user:y,presses:$}=G(),p=$.filter(s=>s.active&&!s.archived).map(s=>s.name),[H,k]=d.useState(!1),[i,f]=d.useState(null),[t,c]=d.useState({name:"",presses:[],active:!0}),[h,z]=d.useState(!1),[r,S]=d.useState(!1),[v,T]=d.useState([]);d.useEffect(()=>{r&&T(x)},[r,x]);const C=(s,a,l)=>{T(N=>N.map(m=>m.id===s?{...m,[a]:l}:m))},J=()=>{v.forEach(s=>{const a=x.find(l=>l.id===s.id);a&&JSON.stringify(a)!==JSON.stringify(s)&&A(s)}),o.success("Changes saved successfully"),S(!1)},I=s=>{s?(f(s),c({name:s.name,presses:s.presses,active:s.active})):(f(null),c({name:"",presses:[],active:!0}),k(!0))},b=()=>{k(!1),f(null),c({name:"",presses:[],active:!0})},L=s=>{c(a=>({...a,presses:a.presses.includes(s)?a.presses.filter(l=>l!==s):[...a.presses,s]}))},R=s=>{if(s.preventDefault(),!t.name.trim()){o.error("Please enter category name");return}if(t.presses.length===0){o.error("Please select at least one press");return}if(i){const a={...i,...t};A(a),o.success("Category updated successfully"),j({user:y?.username||"Unknown",action:"Updated",entity:"Category",entityId:i.id,entityName:t.name,details:`Updated category presses: ${t.presses.join(", ")}`})}else O(t),o.success("Category added successfully"),j({user:y?.username||"Unknown",action:"Created",entity:"Category",entityId:"new",entityName:t.name,details:`Added new category with presses: ${t.presses.join(", ")}`});b()},q=(s,a)=>{B(s),o.success(`Category "${a}" deleted successfully`),j({user:y?.username||"Unknown",action:"Deleted",entity:"Category",entityId:s,entityName:a,details:"Deleted category"})},E=x.filter(s=>h?!0:s.active);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-gray-900",children:"Category Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage maintenance task categories"})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(n,{variant:h?"secondary":"outline",size:"sm",onClick:()=>z(!h),className:h?"bg-gray-200 hover:bg-gray-300 text-gray-900":"text-gray-500",children:h?"Showing Inactive":"Show Inactive"})}),e.jsxs("div",{className:"flex gap-2",children:[r&&e.jsx(n,{onClick:J,children:"Save Changes"}),e.jsx(n,{onClick:()=>S(!r),variant:"outline",children:r?"Cancel":"Edit Mode"}),e.jsxs(n,{onClick:()=>I(),className:"gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Add Category"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(D,{className:"bg-gray-50 hover:bg-gray-50",children:[e.jsx(u,{className:"border-r border-gray-200 font-semibold text-gray-900",children:"Name"}),p.map(s=>e.jsx(u,{className:"w-[100px] text-center border-r border-gray-200 font-semibold text-gray-900",children:s},s)),e.jsx(u,{className:"w-[100px] text-center border-r border-gray-200 font-semibold text-gray-900",children:"Status"}),!r&&e.jsx(u,{className:"text-right w-[100px] font-semibold text-gray-900",children:"Actions"})]})}),e.jsx(ae,{children:(r?v:E).length===0?e.jsx(D,{children:e.jsx(g,{colSpan:r?5:6,className:"text-center py-12 text-gray-500",children:"No categories found."})}):(r?v:E).map(s=>e.jsxs(D,{className:"hover:bg-gray-50/50",children:[e.jsx(g,{className:"border-r border-gray-200 font-medium",children:r?e.jsx(P,{value:s.name,onChange:a=>C(s.id,"name",a.target.value),className:"h-8"}):s.name}),p.map(a=>e.jsx(g,{className:"border-r border-gray-200 p-0",children:e.jsx("div",{className:"flex justify-center items-center h-full py-2",children:r?e.jsx(M,{checked:s.presses.includes(a),onCheckedChange:l=>{const N=l?[...s.presses,a]:s.presses.filter(m=>m!==a);C(s.id,"presses",N)}}):s.presses.includes(a)?e.jsx(K,{className:"w-5 h-5 text-green-600"}):e.jsx("span",{className:"text-gray-300",children:"-"})})},a)),e.jsx(g,{className:"border-r border-gray-200 text-center",children:r?e.jsx("div",{className:"flex justify-center",children:e.jsx(U,{checked:s.active,onCheckedChange:a=>C(s.id,"active",a)})}):s.active?e.jsx(F,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Active"}):e.jsx(F,{variant:"outline",className:"bg-gray-50 text-gray-600 border-gray-200",children:"Inactive"})}),!r&&e.jsx(g,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>I(s),children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsxs(te,{children:[e.jsx(re,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"sm",children:e.jsx(Q,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Delete Category"}),e.jsxs(de,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone.']})]}),e.jsxs(ce,{children:[e.jsx(oe,{children:"Cancel"}),e.jsx(he,{onClick:()=>q(s.id,s.name),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]},s.id))})]})}),e.jsx(V,{open:H||!!i,onOpenChange:b,children:e.jsxs(W,{className:"max-w-md",children:[e.jsxs(X,{children:[e.jsx(Y,{children:i?"Edit Category":"Add New Category"}),e.jsx(Z,{children:i?"Update the category details below.":"Fill in the details for the new category."})]}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"categoryName",children:"Name *"}),e.jsx(P,{id:"categoryName",placeholder:"e.g., Smering",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(w,{children:"Available Presses *"}),e.jsx("div",{className:"space-y-2 border rounded-md p-3",children:p.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{id:`category-${s}`,checked:t.presses.includes(s),onCheckedChange:()=>L(s)}),e.jsx("label",{htmlFor:`category-${s}`,className:"text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:s})]},s))})]}),e.jsxs("div",{className:"flex items-center justify-between border rounded-md p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(w,{htmlFor:"categoryActive",children:"Active Status"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Inactive categories won't appear in task lists"})]}),e.jsx(U,{id:"categoryActive",checked:t.active,onCheckedChange:s=>c({...t,active:s})})]})]}),e.jsxs(_,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:b,children:"Cancel"}),e.jsx(n,{type:"submit",children:i?"Update Category":"Add Category"})]})]})]})})]})}export{Ce as CategoryManagement};
